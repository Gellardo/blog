<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Fixing my GRUB install - Frank&#39;s Blog</title>
  <meta name="description" content="After another instance of my Laptop no longer &ldquo;working&rdquo; after a firmware update, I decided to write down how to recover so I know where to look for it.
How I probably broke it (again) Keeping firmware relatively up to date is a good thing. But fwupd seems to constantly break my UEFI boot, leading to my Laptop being confused and skipping the SSD, instead trying to boot vie PXE.">
  <meta name="author" content="Frank Schmidt"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Frank\x27s Blog",
    
    "url": "https:\/\/gellardo.github.io\/blog\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/gellardo.github.io\/blog\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/gellardo.github.io\/blog\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/gellardo.github.io\/blog\/posts\/2022-09-26-fixing-grub\/",
          "name": "Fixing my g r u b install"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Frank Schmidt"
  },
  "headline": "Fixing my GRUB install",
  "description" : "After another instance of my Laptop no longer \x26ldquo;working\x26rdquo; after a firmware update, I decided to write down how to recover so I know where to look for it.\nHow I probably broke it (again) Keeping firmware relatively up to date is a good thing. But fwupd seems to constantly break my UEFI boot, leading to my Laptop being confused and skipping the SSD, instead trying to boot vie PXE.",
  "inLanguage" : "en",
  "wordCount":  464 ,
  "datePublished" : "2022-09-26T11:30:00",
  "dateModified" : "2022-09-26T11:30:00",
  "image" : "https:\/\/gellardo.github.io\/blog\/",
  "keywords" : [ "shell" ],
  "mainEntityOfPage" : "https:\/\/gellardo.github.io\/blog\/posts\/2022-09-26-fixing-grub\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/gellardo.github.io\/blog\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/gellardo.github.io\/blog\/",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Fixing my GRUB install" />
<meta property="og:description" content="After another instance of my Laptop no longer &ldquo;working&rdquo; after a firmware update, I decided to write down how to recover so I know where to look for it.
How I probably broke it (again) Keeping firmware relatively up to date is a good thing. But fwupd seems to constantly break my UEFI boot, leading to my Laptop being confused and skipping the SSD, instead trying to boot vie PXE.">
<meta property="og:url" content="https://gellardo.github.io/blog/posts/2022-09-26-fixing-grub/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Frank&#39;s Blog" />

  <meta name="twitter:title" content="Fixing my GRUB install" />
  <meta name="twitter:description" content="After another instance of my Laptop no longer &ldquo;working&rdquo; after a firmware update, I decided to write down how to recover so I know where to look for it.
How I probably broke it (again) â€¦">
  <meta name="twitter:card" content="summary" />
  <meta name="generator" content="Hugo 0.68.3" />
  <link rel="alternate" href="https://gellardo.github.io/blog/index.xml" type="application/rss+xml" title="Frank&#39;s Blog"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://gellardo.github.io/blog/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://gellardo.github.io/blog/css/highlight.min.css" /><link rel="stylesheet" href="https://gellardo.github.io/blog/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://gellardo.github.io/blog/">Frank&#39;s Blog</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="/blog/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/blog/pages/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/blog/tags">Tags</a>
            </li>
          
        

        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="posts-heading">
              
                <h1>Fixing my GRUB install</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>After another instance of my Laptop no longer &ldquo;working&rdquo; after a firmware update, I decided to write down how to recover so I know where to look for it.</p>
<h2 id="how-i-probably-broke-it-again">How I probably broke it (again)</h2>
<p>Keeping firmware relatively up to date is a good thing.
But <code>fwupd</code> seems to constantly break my UEFI boot, leading to my Laptop being confused and skipping the SSD, instead trying to boot vie PXE.</p>
<p>The first time this was terrifying but after a few repetitions, it is only annoying.
It seems the firmware updater is written into the EFI partition without any regard for the existing boot loader.
Or (more unlikely) actively breaks it during the firmware update.</p>
<p>But I won&rsquo;t pretend I have any clue about what actually happens, so let&rsquo;s fix the boot.</p>
<h2 id="fixing-it">Fixing it</h2>
<p>Again, there might be a better way of doing it, but this worked for me.</p>
<p>General approach:</p>
<ol>
<li>Boot a live Linux</li>
<li>Mount the filesystem(s)</li>
<li>chroot into the system</li>
<li>run grub-install</li>
</ol>
<h3 id="boot-a-live-linux">Boot a live Linux</h3>
<p>Somehow we need something to install GRUB, where the easiest solution is a live-cd with Linux.
In my case, I have a USB-Stick created with <a href="https://www.ventoy.net/en/index.html">Ventoy</a> lying around.
This enables me to just copy an <code>.iso</code> onto it and boot from it.
I already have a relatively recent Arch Linux live-cd on it.</p>
<p>Insert USB stick, start computer and it is happy that there is actually something to boot.</p>
<h3 id="mount-the-filesystems">Mount the filesystem(s)</h3>
<p>I remember from the Arch install, that I chrooted into the system before installing GRUB.
Technically, I need <code>/boot</code> which has the GRUB config and <code>/boot/efi</code> which contains the UEFI &ldquo;stuff&rdquo;.</p>
<p>So minimal setup (I guess):
I want to mount everything up to <code>/boot/efi</code>, which in my case is 3 partitions: <code>/</code>, <code>/boot</code> and <code>/boot/efi</code>.
My setup has BTRFS on <code>/</code> (with some subvolumes), but I don&rsquo;t want to remember the actual commands.
Luckily I could just copy <code>/etc/fstab</code> to the live system, adopt it and then just <code>mount</code> it.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">mount /dev/nvme0n1p3 /mnt <span style="color:#998;font-style:italic"># mount the root filesystem to /mnt</span>
cp /mnt/root/etc/fstab /etc/fstab <span style="color:#998;font-style:italic"># copy out the fstab from the root subvolume</span>
umount /mnt
vim /etc/fstab <span style="color:#998;font-style:italic"># replace / with /mnt since we already have a /</span>
mount /mnt
mount /mnt/boot
mount /mnt/boot/efi
</code></pre></div><h3 id="chroot-into-the-system"><code>chroot</code> into the system</h3>
<p>Simple (on the archlinux live system): <code>arch-chroot /mnt</code></p>
<p>I guess this might be a bit more involved if you need to run <code>chroot</code> directly.</p>
<h3 id="reinstall-grub">Reinstall GRUB</h3>
<p>Everything has been set up, we just need to install grub to the SSD again and then reboot (and ðŸ¤ž)</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">grub-install --target<span style="font-weight:bold">=</span>x86_64-efi --efi-directory<span style="font-weight:bold">=</span>/boot/efi --recheck /dev/nvme0n1
</code></pre></div><h2 id="future-additions">Future additions</h2>
<ul>
<li>how to handle encrypted root/boot filesystem (yeah I know, I should have done that a long time ago)</li>
<li>can I do this, only mounting <code>/boot/efi</code> and copying grub-config to the live system (aka without chroot)?</li>
</ul>


        
          <div class="blog-tags">
            
              <a href="https://gellardo.github.io/blog//tags/shell/">shell</a>&nbsp;
            
          </div>
        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://gellardo.github.io/blog/posts/2022-09-26-tip-python-shell/" data-toggle="tooltip" data-placement="top" title="Tip: Spawn an interactive Python Shell anywhere in your code">&larr; Previous Post</a>
            </li>
          
          
        </ul>
      


      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="https://github.com/Gellardo" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              Frank Schmidt
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2022
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://gellardo.github.io/blog/">Frank&#39;s Blog</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.68.3</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://gellardo.github.io/blog/js/main.js"></script>
<script src="https://gellardo.github.io/blog/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://gellardo.github.io/blog/js/load-photoswipe.js"></script>









    
  </body>
</html>

